server:
  port: 10000

spring:
  application:
    name: api-gateway

  threads:
    virtual:
      enabled: true

  cloud:
    gateway:
      mvc:
        cors:
          cors-configurations:
            '[/**]':
              allowed-origins:
                - "http://localhost:5173"
                - "http://localhost:5174"
                - "http://localhost:3000"
                - "http://127.0.0.1:5173"
              allowed-methods:
                - GET
                - POST
                - PUT
                - DELETE
                - OPTIONS
                - PATCH
              allowed-headers: "*"
              allow-credentials: true
              max-age: 3600

  # Redis configuration (L2 cache)
  data:
    redis:
      host: localhost
      port: 6379
      timeout: 100ms

# Resilience4j Circuit Breaker Configuration
resilience4j:
  circuitbreaker:
    instances:
      authService:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 30s
        permitted-number-of-calls-in-half-open-state: 3
  retry:
    instances:
      authService:
        max-attempts: 3
        wait-duration: 500ms
  timelimiter:
    instances:
      authService:
        timeout-duration: 3s

# Actuator & Metrics
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    tags:
      application: api-gateway

# Custom gateway configuration
gateway:
  auth:
    service-url: http://localhost:9001
    validate-endpoint: /api/v1/auth/validate
  items:
    service-url: http://localhost:9000
  cache:
    caffeine:
      ttl-seconds: 60
      max-size: 10000
    redis:
      ttl-seconds: 300
  ratelimit:
    anonymous:
      requests-per-minute: 60
      burst: 10
    authenticated:
      requests-per-minute: 300
      burst: 50
